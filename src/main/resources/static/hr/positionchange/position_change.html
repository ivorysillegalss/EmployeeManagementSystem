<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>人事管理页面</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    input {
      padding: 10px;
      margin: 5px;
      width: calc(50% - 22px);
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #4CAF50;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #f1f1f1;
    }

    .search-container {
      margin: 20px 0;
      text-align: right;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>人事管理页面</h1>

  <div class="form-container">
    <input type="text" id="user_id" placeholder="变更员工ID" required>
    <input type="text" id="hr_id" placeholder="操作人" required>
    <input type="text" id="formal_position" placeholder="原职位" required>
    <input type="text" id="after_position" placeholder="现职位" required>
    <button onclick="addEmployee()">提交变更</button>
  </div>

  <div class="search-container">
    <input type="text" id="searchInput" onkeyup="searchEmployees()" placeholder="搜索员工...">
  </div>

  <table id="employeeTable">
    <thead>
    <tr>
      <th>变更员工ID</th>
      <th>操作人</th>
      <th>原职位</th>
      <th>现职位</th>
      <th>操作</th>
    </tr>
    </thead>
    <tbody>
    <!-- 员工数据将插入这里 -->
    </tbody>
  </table>
</div>

<!-- 引入axios库 -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  // 提交变更到后端接口
  function addEmployee() {
    const userId = document.getElementById('user_id').value;
    const hrId = document.getElementById('hr_id').value;
    const formalPosition = document.getElementById('formal_position').value;
    const afterPosition = document.getElementById('after_position').value;

    // 构造请求数据
    const positionChangeDTO = {
      userId: parseInt(userId),
      hrId: parseInt(hrId),
      formalPosition: formalPosition,
      afterPosition: afterPosition
    };

    // 发送POST请求到后端接口
    axios.post('http://localhost:3000/hr/position/change', positionChangeDTO)
            .then(function (response) {
              if (response.data.code === "0") {
                alert('变更成功');
                // 更新表格显示
                loadEmployeeData();
              } else {
                alert('变更失败: ' + response.data.message);
              }
            })
            .catch(function (error) {
              console.error('请求失败:', error);
              alert('变更过程中出现错误，请稍后再试。');
            });
  }

  // 加载员工数据并渲染表格
  function loadEmployeeData() {
    axios.get('http://localhost:3000/boss/position/change')
            .then(function (response) {
              console.log(response.data)
              if (response.data.code === "0") {
                renderTable(response.data.data);
              } else {
                alert('获取员工数据失败: ' + response.data.message);
              }
            })
            .catch(function (error) {
              console.error('请求失败:', error);
              alert('获取员工数据时发生错误，请稍后再试。');
            });
  }

  // 将数据渲染到表格
  function renderTable(data) {
    const tableBody = document.getElementById('employeeTable').getElementsByTagName('tbody')[0];
    tableBody.innerHTML = ''; // 清空现有的表格数据

    // 假数据
    const mockData = [
      { userId: '1001', hrId: '2001', formalPosition: '工程师', afterPosition: '高级工程师' },
      { userId: '1002', hrId: '2002', formalPosition: '设计师', afterPosition: '高级设计师' },
      { userId: '1003', hrId: '2003', formalPosition: '测试员', afterPosition: '测试经理' }
    ];

    // 将假数据和实际数据合并
    const combinedData = [...data, ...mockData];

    // 渲染合并后的数据
    combinedData.forEach(function (item) {
      const row = document.createElement('tr');
      row.innerHTML = `
            <td>${item.userId}</td>
            <td>${item.hrId}</td>
            <td>${item.formalPosition}</td>
            <td>${item.afterPosition}</td>
            <td>
                <button onclick="editEmployee(this)">编辑</button>
                <button onclick="deleteEmployee(this)">删除</button>
            </td>
        `;
      tableBody.appendChild(row);
    });
  }


  // 编辑员工变更信息
  function editEmployee(button) {
    const row = button.parentElement.parentElement;
    document.getElementById('user_id').value = row.cells[0].innerText;
    document.getElementById('hr_id').value = row.cells[1].innerText;
    document.getElementById('formal_position').value = row.cells[2].innerText;
    document.getElementById('after_position').value = row.cells[3].innerText;

    // 删除当前行
    deleteEmployee(button);
  }

  // 删除员工信息
  function deleteEmployee(button) {
    const row = button.parentElement.parentElement;
    row.parentElement.removeChild(row);
  }

  // 搜索功能
  function searchEmployees() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toLowerCase();
    const table = document.getElementById('employeeTable');
    const tr = table.getElementsByTagName('tr');

    for (let i = 1; i < tr.length; i++) {
      let row = tr[i];
      let found = false;

      for (let j = 0; j < row.cells.length - 1; j++) {
        if (row.cells[j].innerText.toLowerCase().indexOf(filter) > -1) {
          found = true;
          break;
        }
      }

      row.style.display = found ? '' : 'none';
    }
  }

  // 加载数据时调用
  loadEmployeeData();
</script>
</body>

</html>
